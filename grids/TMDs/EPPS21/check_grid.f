      program master
      implicit none 
      integer NX, NB
      parameter (NX=126,NB=51)
      double precision M2, Q, BB(NB), XB(NX), zh
      integer TIH,TIC,FINI,K1,K3,TMDPINI(2)
      real*8  u, d, s, ub, db, sb, g
      real*8 fu,fd,fs,fub,fdb,fsb,fg
      real*8 b
      integer nloops
      COMMON /TMDPRAGINI/ TMDPINI
      COMMON / ttarget   / TIH,TIC
      integer IIREAD

      FINI = 0
      TMDPINI(1) = 0
      TMDPINI(2) = 0
      data TIH,TIC /4,1/

      nloops = 2

!       DATA XB /1.00d-5,1.26d-5,1.56d-5,2.02d-5,2.56d-5,3.24d-5,4.09d-5,
!     $          5.18d-5,6.55d-5,8.29d-5,1.05d-4,1.33d-4,1.68d-4,2.12d-4,
!     $          2.68d-4,3.39d-4,4.29d-4,5.43d-4,6.87d-4,8.69d-4,1.10d-3,
!     $          1.39d-3,1.76d-3,2.22d-3,2.81d-3,3.56d-3,4.50d-3,5.69d-3,
!     $          7.20d-3,9.10d-3,1.15d-2,1.46d-2,1.84d-2,2.33d-2,2.95d-2,
!     $          3.73d-2,4.71d-2,5.96d-2,7.54d-2,9.54d-2,1.21d-1,1.53d-1,
!     $          1.93d-1,2.44d-1,3.09d-1,3.91d-1,4.94d-1,6.25d-1,7.91d-1,
!     $          9.90d-1/

!      DATA XB /0.001, 0.0011514 , 0.00132571, 0.00152642, 0.00175751,
!     $    0.00202359, 0.00232995, 0.0026827 , 0.00308884, 0.00355648,
!     $    0.00409492, 0.00471487, 0.00542868, 0.00625055, 0.00719686,
!     $    0.00828643, 0.00954095, 0.01098541, 0.01264855, 0.01456348,
!     $    0.01676833, 0.01930698, 0.02222996, 0.02559548, 0.02947052,
!     $    0.03393222, 0.0390694 , 0.04498433, 0.05179475, 0.05963623,
!     $    0.06866488, 0.07906043, 0.09102982, 0.10481131, 0.12067926,
!     $    0.13894955, 0.15998587, 0.184207  , 0.21209509, 0.24420531,
!     $    0.28117687, 0.32374575, 0.37275937, 0.42919343, 0.49417134,
!     $    0.5689866 , 0.65512856, 0.75431201, 0.86851137, 0.99       /

!      DATA XB/0.001, 0.02138776, 0.04177551, 0.06216327, 0.08255102,
!     $   0.10293878, 0.12332653, 0.14371429, 0.16410204, 0.1844898 ,
!     $   0.20487755, 0.22526531, 0.24565306, 0.26604082, 0.28642857,
!     $   0.30681633, 0.32720408, 0.34759184, 0.36797959, 0.38836735,
!     $   0.4087551 , 0.42914286, 0.44953061, 0.46991837, 0.49030612,
!     $   0.51069388, 0.53108163, 0.55146939, 0.57185714, 0.5922449 ,
!     $   0.61263265, 0.63302041, 0.65340816, 0.67379592, 0.69418367,
!     $   0.71457143, 0.73495918, 0.75534694, 0.77573469, 0.79612245,
!     $   0.8165102 , 0.83689796, 0.85728571, 0.87767347, 0.89806122,
!     $   0.91844898, 0.93883673, 0.95922449, 0.97961224, 0.99        /

!      DATA XB/0.001, 0.00107227, 0.00114976, 0.00123285, 0.00132194,
!     $   0.00141747, 0.00151991, 0.00162975, 0.00174753, 0.00187382,
!     $   0.00200923, 0.00215443, 0.00231013, 0.00247708, 0.00265609,
!     $   0.00284804, 0.00305386, 0.00327455, 0.00351119, 0.00376494,
!     $   0.00403702, 0.00432876, 0.00464159, 0.00497702, 0.0053367 ,
!     $   0.00572237, 0.00613591, 0.00657933, 0.0070548 , 0.00756463,
!     $   0.00811131, 0.00869749, 0.00932603, 0.01      , 0.01072267,
!     $   0.01149757, 0.01232847, 0.01321941, 0.01417474, 0.01519911,
!     $   0.01629751, 0.01747528, 0.01873817, 0.02009233, 0.02154435,
!     $   0.0231013 , 0.02477076, 0.02656088, 0.02848036, 0.03053856,
!     $   0.03274549, 0.03511192, 0.03764936, 0.04037017, 0.04328761,
!     $   0.04641589, 0.04977024, 0.05336699, 0.05722368, 0.06135907,
!     $   0.06579332, 0.07054802, 0.07564633, 0.08111308, 0.0869749 ,
!     $   0.09326033, 0.1       , 0.10722672, 0.1149757 , 0.12328467,
!     $   0.13219411, 0.14174742, 0.15199111, 0.16297508, 0.17475284,
!     $   0.18738174, 0.2009233 , 0.21544347, 0.23101297, 0.24770764,
!     $   0.26560878, 0.28480359, 0.30538555, 0.32745492, 0.35111917,
!     $   0.37649358, 0.40370173, 0.43287613, 0.46415888, 0.49770236,
!     $   0.53366992, 0.57223677, 0.61359073, 0.65793322, 0.70548023,
!     $   0.75646333, 0.81113083, 0.869749  , 0.93260335, 0.99       /

!      DATA XB/0.00562341,0.00592553,0.00624388,0.00657933,0.00693281,
!     $        0.00730527,0.00769775,0.00811131,0.00854709,0.00900628,
!     $        0.00949014,0.01      ,0.01053725,0.01110336,0.01169989,
!     $        0.01232847,0.01299081,0.01368875,0.01442417,0.01519911,
!     $        0.01601568,0.01687612,0.01778279,0.01873817,0.01974488,
!     $        0.02080568,0.02192346,0.0231013 ,0.02434241,0.02565021,
!     $        0.02702827,0.02848036,0.03001047,0.03162278,0.03332171,
!     $        0.03511192,0.0369983 ,0.03898604,0.04108056,0.04328761,
!     $        0.04561324,0.04806381,0.05064604,0.05336699,0.05623413,
!     $        0.05925531,0.0624388 ,0.06579332,0.06932807,0.07305272,
!     $        0.07697747,0.08111308,0.08547088,0.0900628 ,0.09490142,
!     $        0.1       ,0.1053725 ,0.11103363,0.11699891,0.12328467,
!     $        0.12990814,0.13688745,0.14424173,0.15199111,0.16015683,
!     $        0.16876125,0.17782794,0.18738174,0.19744882,0.20805675,
!     $        0.2192346 ,0.23101297,0.24342414,0.25650209,0.27028266,
!     $        0.28480359,0.30010465,0.31622777,0.33321709,0.35111917,
!     $        0.36998304,0.38986037,0.41080561,0.43287613,0.45613239,
!     $        0.48063809,0.50646035,0.53366992,0.56234133,0.5925531 ,
!     $        0.624388  ,0.65793322,0.69328067,0.73052715,0.76977471,
!     $        0.81113083,0.85470881,0.90062802,0.94901424,0.99      /


!      DATA XB/0.025, 0.02683227, 0.02879882, 0.0309095 , 0.03317488,
!     $   0.03560629, 0.0382159 , 0.04101677, 0.04402291, 0.04724938,
!     $   0.05071232, 0.05442906, 0.0584182 , 0.06269971, 0.06729501,
!     $   0.0722271 , 0.07752068, 0.08320222, 0.08930016, 0.09584503,
!     $   0.10286957, 0.11040895, 0.1185009 , 0.1271859 , 0.13650744,
!     $   0.14651216, 0.15725013, 0.1687751 , 0.18114473, 0.19442095,
!     $   0.20867019, 0.22396376, 0.24037821, 0.25799569, 0.27690436,
!     $   0.29719886, 0.31898076, 0.34235907, 0.36745079, 0.3943815 ,
!     $   0.42328597, 0.45430888, 0.48760547, 0.5233424 , 0.5616985 ,
!     $   0.60286575, 0.64705018, 0.6944729 , 0.74537128, 0.80000002/


      DATA XB/0.029 ,0.031 ,0.032 ,0.034 ,0.035 ,0.0358,0.037 ,0.038 ,
     $ 0.0384,0.039 ,0.0396,0.0397,0.0397,0.0398,0.04  ,0.041 ,0.042 ,
     $ 0.043 ,0.044 ,0.045 ,0.046 ,0.0487,0.0625,0.0625,0.0626,0.0629,
     $ 0.07  ,0.071 ,0.072 ,0.073 ,0.074 ,0.075 ,0.076 ,0.077 ,0.079 ,
     $ 0.084 ,0.086 ,0.087 ,0.089 ,0.091 ,0.092 ,0.093 ,0.094 ,0.095 ,
     $ 0.096 ,0.097 ,0.098 ,0.099 ,0.0999,0.1   ,0.1002,0.1004,0.1005,
     $ 0.1008,0.101 ,0.102 ,0.103 ,0.105 ,0.106 ,0.107 ,0.109 ,0.11  ,
     $ 0.111 ,0.112 ,0.115 ,0.116 ,0.119 ,0.12  ,0.121 ,0.122 ,0.123 ,
     $ 0.124 ,0.126 ,0.128 ,0.129 ,0.13  ,0.132 ,0.133 ,0.134 ,0.136 ,
     $ 0.14  ,0.156 ,0.1599,0.1607,0.1608,0.1609,0.163 ,0.164 ,0.176 ,
     $ 0.177 ,0.179 ,0.185 ,0.186 ,0.1946,0.206 ,0.236 ,0.238 ,0.239 ,
     $ 0.24  ,0.242 ,0.243 ,0.245 ,0.246 ,0.247 ,0.248 ,0.249 ,0.251 ,
     $ 0.252 ,0.254 ,0.257 ,0.265 ,0.266 ,0.268 ,0.273 ,0.274 ,0.275 ,
     $ 0.276 ,0.2781,0.2847,0.2852,0.349 ,0.351 ,0.391 ,0.638 ,0.64  ,
     $ 0.66 /

      DATA BB /1.00d-4,1.26d-4,1.56d-4,2.02d-4,2.56d-4,3.24d-4,4.09d-4,
     $          5.18d-4,6.55d-4,8.29d-4,1.05d-3,1.33d-3,1.68d-3,2.12d-3,
     $          2.68d-3,3.39d-3,4.29d-3,5.43d-3,6.87d-3,8.69d-3,1.10d-2,
     $          1.39d-2,1.76d-2,2.22d-2,2.81d-2,3.56d-2,4.50d-2,5.69d-2,
     $          7.20d-2,9.10d-2,1.15d-1,1.46d-1,1.84d-1,2.33d-1,2.95d-1,
     $          3.73d-1,4.71d-1,5.96d-1,7.54d-1,9.54d-1,1.21d0 ,1.53d0 ,
     $   1.73d0,1.93d0 ,2.44d0 ,3.09d0 ,3.91d0 ,4.94d0 ,6.25d0 ,7.91d0 ,
     $          1.00e1/

      IF ((TIH.EQ.1).and.(TIC.EQ.-1)) THEN
       call InitPDFsetByName("JAM18PionPDFnlo")
      ELSEIF ((TIH.EQ.4).and.(TIC.EQ.1)) THEN
!       call InitPDFsetByName("CT14nlo")
       call InitPDFsetByName("HERAPDF20_NLO_VAR")
        ELSE
         WRITE(6,93)
 93	 FORMAT (2X,' WRONG SET')
         STOP
      END IF

c-----generate Q2 TMD grid
      DO 1 K1 = 1, NX-1           ! zh loop 
!            zh = 0.5d0*(XB(K1)+XB(K1+1))
            zh = XB(K1)
            DO 3 K3 = 1, NB-1       ! b loop
               B = 0.5d0*(BB(K3)+BB(K3+1))
!               B = BB(K3)
               Q = 1.12292d0*dsqrt(1d0+4d0/9d0*b*b)/b
               call PDF_P(zh,Q,U,D,UB,DB,S,SB,G,nloops)
               TMDPINI = 0
               call getTMDPDF(zh,b,fu,fd,fs,fub,fdb,fsb)
               if (dabs(1.-u/fu)>0.01) then
               print *, zh,b,u/fu
               endif
*     
 3          CONTINUE
 1    CONTINUE

*     
  90  FORMAT (9(E14.5))
*     
      WRITE(6,*) 'DONE'
      CLOSE(1)
      
      return
      end


